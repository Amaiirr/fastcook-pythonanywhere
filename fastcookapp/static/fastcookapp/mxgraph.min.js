function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var o=jQuery.trim(n[a]);if(o.substring(0,e.length+1)===e+"="){t=decodeURIComponent(o.substring(e.length+1));break}}return t}function setCookie(e,t,n){var a="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),a="; expires="+o.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"}var csrftoken=getCookie("csrftoken");function hideOnClk(e){var t=document.getElementById("byCategory"),n=document.getElementById("search");n.style.display="searchImage"==e?(document.getElementById("categoryImage").style.display="block",document.getElementById(e).style.display="none",t.style.display="none","block"):(document.getElementById("searchImage").style.display="block",document.getElementById(e).style.display="none",t.style.display="block","none")}var onStar=0;function mxIconSet(n){this.images=[];var e,a=n.view.graph;(e=mxUtils.createImage("/images/copy.png")).setAttribute("title","Duplicate"),e.style.position="absolute",e.style.cursor="pointer",e.style.width="16px",e.style.height="16px",e.style.left=n.x+n.width+"px",e.style.top=n.y+n.height+"px",mxEvent.addGestureListeners(e,mxUtils.bind(this,function(e){var t=a.gridSize;a.setSelectionCells(a.moveCells([n.cell],t,t,!0)),mxEvent.consume(e),this.destroy()})),n.view.graph.container.appendChild(e),this.images.push(e),(e=mxUtils.createImage("/images/delete2.png")).setAttribute("title","Delete"),e.style.position="absolute",e.style.cursor="pointer",e.style.width="16px",e.style.height="16px",e.style.left=n.x+n.width+"px",e.style.top=n.y-16+"px",mxEvent.addGestureListeners(e,mxUtils.bind(this,function(e){mxEvent.consume(e)})),mxEvent.addListener(e,"click",mxUtils.bind(this,function(e){a.removeCells([n.cell]),mxEvent.consume(e),this.destroy()})),n.view.graph.container.appendChild(e),this.images.push(e)}$(document).ready(function(){$("#stars li").on("mouseover",function(){var t=parseInt($(this).data("value"),10);$(this).parent().children("li.star").each(function(e){e<t?$(this).addClass("hover"):$(this).removeClass("hover")})}).on("mouseout",function(){$(this).parent().children("li.star").each(function(e){$(this).removeClass("hover")})}),$("#stars li").on("click",function(){onStar=parseInt($(this).data("value"),10);var e=$(this).parent().children("li.star");for(i=0;i<e.length;i++)$(e[i]).removeClass("selected");for(i=0;i<onStar;i++)$(e[i]).addClass("selected")})}),mxIconSet.prototype.destroy=function(){if(null!=this.images)for(var e=0;e<this.images.length;e++){var t=this.images[e];t.parentNode.removeChild(t)}this.images=null};var myEvent=window.attachEvent||window.addEventListener,chkevent=window.attachEvent?"onbeforeunload":"beforeunload";function main(){mxGraph.prototype.setAllowDanglingEdges(!1),mxConnectionHandler.prototype.connectImage=new mxImage("/images/connector.gif",16,16),mxGraphHandler.prototype.guidesEnabled=!0,mxGuide.prototype.isEnabledForEvent=function(e){return!mxEvent.isAltDown(e)};var e=new mxEditor,c=e.graph;c.getModel();c.dropEnabled=!0;var t,n,a,o;if(c.addMouseListener({currentState:null,currentIconSet:null,mouseDown:function(e,t){null!=this.currentState&&(this.dragLeave(t.getEvent(),this.currentState),this.currentState=null)},mouseMove:function(e,t){if(null!=this.currentState&&(t.getState()==this.currentState||null==t.getState())){var n=new mxRectangle(t.getGraphX()-20,t.getGraphY()-20,40,40);if(mxUtils.intersects(n,this.currentState))return}n=c.view.getState(t.getCell());(c.isMouseDown||null!=n&&!c.getModel().isVertex(n.cell))&&(n=null),n!=this.currentState&&(null!=this.currentState&&this.dragLeave(t.getEvent(),this.currentState),this.currentState=n,null!=this.currentState&&this.dragEnter(t.getEvent(),this.currentState))},mouseUp:function(e,t){},dragEnter:function(e,t){null==this.currentIconSet&&(this.currentIconSet=new mxIconSet(t))},dragLeave:function(e,t){null!=this.currentIconSet&&(this.currentIconSet.destroy(),this.currentIconSet=null)}}),$(".shareElements").on("input blur paste",function(){$(this).val($(this).val().replace(/\D/g,""))}),$("#share").on("click",function(e){var t=(new mxCodec).encode(c.getModel());sharedXMLData=mxUtils.getXml(t),$('input[name="currentGraphId"]').val($("#idOfGraph").val()),$('input[name="rating"]').val(onStar),$('input[name="sharedXMLData"]').val(sharedXMLData),0==onStar&&(e.preventDefault(),$(".error").css("display","block"))}),mxClient.isBrowserSupported()){var r=document.getElementById("searchToolbar"),m=new mxToolbar(r);m.enabled=!1;var l=document.getElementById("toptoolbar"),i=document.getElementById("content"),s=document.getElementById("generalContent"),d=document.getElementById("measurement"),u=document.getElementById("berries"),p=document.getElementById("dairies"),g=document.getElementById("desserts"),v=document.getElementById("dishes"),h=document.getElementById("fruits"),x=document.getElementById("meat"),f=document.getElementById("nut"),y=document.getElementById("vegetables"),b=document.getElementById("seafood"),w=document.getElementById("fastfood"),T=document.getElementById("other"),C=new mxToolbar(i);C.enabled=!1;var E=new mxToolbar(generalContent);E.enabled=!1;var I=new mxToolbar(d);I.enabled=!1;var S=new mxToolbar(u);S.enabled=!1;var k=new mxToolbar(p);k.enabled=!1;var G=new mxToolbar(g);G.enabled=!1;var B=new mxToolbar(h);B.enabled=!1;var D=new mxToolbar(x);D.enabled=!1;var M=new mxToolbar(f);M.enabled=!1;var A=new mxToolbar(y);A.enabled=!1;var O=new mxToolbar(b);O.enabled=!1;var L=new mxToolbar(w);L.enabled=!1;var U=new mxToolbar(T);U.enabled=!1;var X=new mxToolbar(v);X.enabled=!1;var N=new mxToolbar(s);N.enabled=!1;var V,R=document.getElementsByClassName("collapsible");for(V=0;V<R.length;V++)R[V].addEventListener("click",function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"});document.getElementsByClassName("diagramContainer")[0];var F=document.getElementById("container");mxClient.IS_QUIRKS&&(document.body.style.overflow="hidden",new mxDivResizer(tbContainer),new mxDivResizer(F));var j=new mxUndoManager,P=function(e,t){j.undoableEditHappened(t.getProperty("edit"))};c.getModel().addListener(mxEvent.UNDO,P),c.getView().addListener(mxEvent.UNDO,P),c.popupMenuHandler.factoryMethod=function(e,t,n){e.addItem("Undo",null,function(){j.undo()}),e.addItem("Redo",null,function(){j.redo()}),e.addSeparator(),e.addItem("Select vertices",null,function(){c.selectVertices()}),e.addItem("Select all",null,function(){c.selectAll()})};var z=new mxKeyHandler(c);z.bindKey(46,function(e){c.isEnabled()&&c.removeCells()}),z.bindKey(8,function(e){c.isEnabled()&&c.removeCells()}),mxDragSource.prototype.getDropTarget=function(e,t,n){var a=e.getCellAt(t,n);return e.isValidDropTarget(a)||(a=null),a},c.setDropEnabled(!1),c.setAllowDanglingEdges(!1),e.setGraphContainer(F);var J=new mxCell("Group",new mxGeometry,"group");J.setVertex(!0),J.setConnectable(!1),e.defaultGroup=J,e.groupBorderSize=20,c.setConnectable(!0),loadStyleSheet(c,$("#openedGraphxml").val());var H=document.createElement("div");H.style.display="inline",H.style.paddingRight="117px",H.style.borderRight="2px solid #e0e0e0",H.style.borderLeft="2px solid #e0e0e0",H.setAttribute("class","verticalDivider"),l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"groupOrUngroup","(Un)group","/images/group.png"),e.addAction("groupOrUngroup",function(e,t){null!=(t=t||e.graph.getSelectionCell())&&e.graph.isSwimlane(t)?e.execute("ungroup",t):e.execute("group")}),addToolbarButton(e,l,"delete","Delete","/images/delete2.png"),H.style.paddingRight="40px",l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"cut","Cut","/images/cut.png"),addToolbarButton(e,l,"copy","Copy","/images/copy.png"),addToolbarButton(e,l,"paste","Paste","/images/paste.png"),l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"undo","","/images/undo.png"),addToolbarButton(e,l,"redo","","/images/redo.png"),l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"zoomIn","","/images/zoomin.gif"),addToolbarButton(e,l,"zoomOut","","/images/zoomout.gif");var q=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,C,r,t)},K=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,I,r,t)},_=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,S,r,t)},Q=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,k,r,t)},Y=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,G,r,t)},W=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,X,r,t)},Z=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,B,r,t)},ee=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,D,r,t)},te=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,M,r,t)},ne=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,U,r,t)},ae=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,O,r,t)},oe=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,A,r,t)};S.addLine(),I.addLine(),C.addLine();t="/images/text.png",n="text",a="Text",(o=new mxCell(null,new mxGeometry(0,0,100,40),n)).value=a,o.setVertex(!0),addToolbarItem(c,E,o,t),E.addLine()}else mxUtils.error("Browser is not supported!",200,!1);$(document).ready(function(){$("#loadAllTitles").on("click",".openGraph",function(e){$("#openModal").modal("hide");var o=$(this).attr("id"),t=getCookie("csrftoken");$.ajax({type:"GET",url:o,dataType:"text",headers:{"X-CSRFToken":t},success:function(e){var t=JSON.parse(e);xmlGraph=t[0].fields.XMLGraph,title=t[0].fields.title;var n=mxUtils.parseXml(xmlGraph).documentElement;new mxCodec(n.ownerDocument).decode(n,c.getModel()),$("#currentTitle").attr("value",title);var a=parseInt(o.match(/\d+/),10);$("#idOfGraph").val(a)}})})}),$(document).ready(function(){$("#saveNewTitle").on("click",function(e){var t=getCookie("csrftoken");title=$("#newTitle").val();var n=(new mxCodec).encode(c.getModel());xml=mxUtils.getXml(n),currentTitle=$("#currentTitle").val(),graphId=$("#idOfGraph").val(),$.ajax({type:"POST",url:"/saveNewTitle/",dataType:"text",data:{newTitle:title,currentTitle:currentTitle,xml:xml,graphId:graphId},headers:{"X-CSRFToken":t},success:function(e){parseData=JSON.parse(e),parseData.overwrite?alert(title+" already exists"):($("#currentTitle").val(title),$("#saveTitleModal").modal("hide"),$(".currentGraph").each(function(e,t){$(".openGraph").each(function(e,t){$(this).val()==currentTitle&&$(this).val(title)})}))}})})}),$("#loadAllTitles").on("click",".deleteGraph",function(e){var t=getCookie("csrftoken");e.preventDefault();var n=$(this).attr("id"),a=$(this).closest("tr");console.log(n),console.log(a),$.ajax({type:"DELETE",url:n,headers:{"X-CSRFToken":t},success:function(e){a.remove(),0==document.getElementById("graphList").rows.length&&($(window).off("beforeunload"),window.location.href="/profile/")}})}),$(document).ready(function(){$("#openXML").on("click",function(e){var t=getCookie("csrftoken");$.ajax({type:"GET",url:"/loadTitles/",dataType:"text",headers:{"X-CSRFToken":t},success:function(e){window.confirm=function(){return!1};var t=JSON.parse(e),n=Object.keys(t).length,a="/openGraph/"+t[n-1].pk,o=t[n-1].fields.title,r=(t[n-1].pk,'<input type="button" data-dismiss="modal" class = "openGraph btn btn-success" value="'+o+'" id='+a+"/>");0==$("#loadAllTitles").find("#"+$.escapeSelector(a+"/")).length&&$("#graphList").append("<tr> <td>"+r+"</td> </tr>")}})})}),$("#share").on("click",function(e){var t=(new mxCodec).encode(c.getModel());xml=mxUtils.getXml(t)}),$(document).ready(function(){$(".openFile").on("click",function(e){var t=getCookie("csrftoken"),n=(new mxCodec).encode(c.getModel()),a=mxUtils.getXml(n);console.log(a);t=getCookie("csrftoken");var o=$("#openTitle").val();$.ajax({type:"POST",url:"/saveTitle/",data:{saveAsTitle:o,xml:a},dataType:"text",headers:{"X-CSRFToken":t},success:function(e){parseData=JSON.parse(e),parseData.overwrite?alert(o+" is already in use"):($("#idOfGraph").val(parseData.id),c.removeCells(c.getChildVertices(c.getDefaultParent())),c.selectChildCell(),c.removeCells(),$("#currentTitle").attr("value",o))}})})}),$(".dropdown-menu").on("click","#saveButton",function(e){var t=(new mxCodec).encode(c.getModel()),a=mxUtils.getXml(t),o=getCookie("csrftoken");console.log("test"+$("#idOfGraph").val()),$.ajax({type:"POST",url:"/overwrite/",data:{xml:a,title:$("#currentTitle").val(),graphId:$("#idOfGraph").val()},dataType:"text",headers:{"X-CSRFToken":o},success:function(e){var t=$("#currentTitle").val();JSON.parse(e).overwrite&&confirm(t+" already exists. Are you sure you want to overwrite changes to this file?")&&$.ajax({type:"POST",url:"/saveData/",data:{xml:a,title:$("#currentTitle").val()},headers:{"X-CSRFToken":o},success:function(e){var t=mxUtils.parseXml(a).documentElement;new mxCodec(t.ownerDocument).decode(t,c.getModel())}});var n=mxUtils.parseXml(a).documentElement;new mxCodec(n.ownerDocument).decode(n,c.getModel())}})}),$("#saveName").click(function(e){var t=getCookie("csrftoken"),n=(new mxCodec).encode(c.getModel());xml=mxUtils.getXml(n);t=getCookie("csrftoken");var a=$("#saveAsTitle").val();$.ajax({type:"POST",url:"/saveTitle/",data:{saveAsTitle:a,xml:xml},dataType:"text",headers:{"X-CSRFToken":t},success:function(e){var t=JSON.parse(e);t.overwrite?alert(a+" already exists"):($("#currentTitle").attr("value",a),$("#idOfGraph").val(t.id))}})}),$.ajax({url:"/loadIcons/",success:function(e){K("1 tbsp","/images/ingredients/measurement/tablespoon.png/",60,80,"measurement0"),K("1 tsp","/images/ingredients/measurement/teaspoon.png/",60,80,"measurement1"),K("1 scoop","/images/ingredients/measurement/scoop.png/",60,80,"measurement2"),K("1 cup","/images/ingredients/measurement/cup.png/",60,80,"measurement3"),K("1 inch","/images/ingredients/measurement/ruler.png/",60,80,"measurement4"),$("#searchEngine").autocomplete({source:e.allFiles});for(var t,n,a,o,r=3;0<=r;r--)t="60 Minutes",n="/images/ingredients/Equipment/"+e.equipment[r]+"/",a="equipment"+r,o=void 0,(o=new mxCell(t,new mxGeometry(0,0,60,80),a)).setVertex(!0),addToolbarItem(c,N,o,n);for(r=4;0<=r;r--)q("300g","/images/ingredients/Bakery/"+e.bakery[r]+"/",60,80,"rounded"+r);for(r=3;0<=r;r--)_("300g","/images/ingredients/Berries/"+e.berries[r]+"/",60,80,"berries"+r);for(r=2;0<=r;r--)Q("300g","/images/ingredients/Dairies/"+e.dairies[r]+"/",60,80,"dairies"+r);for(r=19;0<=r;r--)Z("300g","/images/ingredients/Fruits/"+e.fruits[r]+"/",60,80,"fruits"+r);for(r=8;0<=r;r--)ee("300g","/images/ingredients/Meat/"+e.meat[r]+"/",60,80,"meat"+r);for(r=3;0<=r;r--)te("300g","/images/ingredients/Nut/"+e.nut[r]+"/",60,80,"nut"+r);for(r=13;0<=r;r--)ne("300g","/images/ingredients/other/"+e.other[r]+"/",60,80,"other"+r);for(r=4;0<=r;r--)ae("300g","/images/ingredients/Seafood/"+e.seafood[r]+"/",60,80,"seafood"+r);for(r=26;0<=r;r--)oe("300g","/images/ingredients/Vegetables/"+e.vegetables[r]+"/",60,80,"vegetables"+r);for(r=18;0<=r;r--)W("300g","/images/ingredients/Dishes/"+e.dishes[r]+"/",60,80,"dishes"+r);for(r=17;0<=r;r--)Y("300g","/images/ingredients/Desserts/"+e.desserts[r]+"/",60,80,"desserts"+r)}}),$.ajax({type:"GET",url:"/home/",dataType:"text",success:function(e){var t=JSON.parse(e).title,n=JSON.parse(t),a=n.length;console.log(a);for(var o=a-1;0<=o;o--){var r=n[o].title,l="/openGraph/"+n[o].id,i=(n[o].id,'<input type="button" data-dismiss="modal" class = "openGraph btn btn-success" value="'+r+'" id='+l+"/>");$("#currentTitle").val()||$("#currentTitle").attr("value",$("#openedGraphTitle").val()),$("#graphList").append("<tr> <td>"+i+"</td> </tr>")}}}),$(document).ready(function(){$("#searchSubmit").on("click",function(e){e.preventDefault(),$.ajax({type:"POST",url:/search/,dataType:"text",headers:{"X-CSRFToken":csrftoken},data:{searchEngine:$("#searchEngine").val()},success:function(e){document.getElementById("noResults").innerHTML="";var t=JSON.parse(e);console.log(t);var n=t[0].results;console.log(n);var a=function(e,t,n,a,o){var r=new mxCell(e,new mxGeometry(0,0,n,a),o);r.setVertex(!0),addToolbarItem(c,m,r,t)};if(n){var o=t[0].length,r=t[0].file_direc;console.log(o),document.getElementById("noResults").innerHTML="";var l=r.replace(/fastcookapp/,""),i=l.split("/")[3],s=l.split("/")[4];s=s.replace(".png","");var d=i.toLowerCase();"equipment"==d?(clearToolbar(),a("60 minutes",l,60,80,d+o)):"tablespoon"==s?(clearToolbar(),a("1 tbsp","/images/ingredients/measurement/tablespoon.png/",60,80,"measurement0")):"teaspoon"==s?(clearToolbar(),a("1 tsp","/images/ingredients/measurement/teaspoon.png/",60,80,"measurement1")):"cup"==s?(clearToolbar(),a("1 cup","/images/ingredients/measurement/scoop.png/",60,80,"measurement2")):"cup"==s?(clearToolbar(),a("1 cup","/images/ingredients/measurement/cup.png/",60,80,"measurement3")):"ruler"==s?(clearToolbar(),a("1 inch","/images/ingredients/measurement/ruler.png/",60,80,"measurement4")):(console.log(d+o),clearToolbar(),a("300g",l,60,80,d+o))}else clearToolbar(),$("#noResults").append("</br> There are no results to be found ")}})})}),$(document).ready(function(){$("#categoryImage").on("click",function(e){clearToolbar()})})}function addToolbarItem(e,t,r,n){var a=function(e,t,n){e.stopEditing(!1);var a=e.getPointForEvent(t),o=e.getModel().cloneCell(r);o.geometry.x=a.x,o.geometry.y=a.y,e.setSelectionCells(e.importCells([o],0,0,n))},o=t.addMode(null,n,a);mxUtils.makeDraggable(o,e,a)}function post(e,t,n){n=n||"post";var a=document.createElement("form");a.setAttribute("method",n),a.setAttribute("action",e),a.setAttribute("target","_blank");var o=document.createElement("input");o.type="hidden",o.name="csrfmiddlewaretoken",o.value=getCookie("csrftoken"),a.appendChild(o);var r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","currentGraphId"),r.setAttribute("value",$("#idOfGraph").val()),a.appendChild(r);var l=document.createElement("input");for(var i in l.setAttribute("type","hidden"),l.setAttribute("name","rating"),l.setAttribute("value",onStar),a.appendChild(l),t)if(t.hasOwnProperty(i)){var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name",i),s.setAttribute("value",t[i]),a.appendChild(s)}document.body.appendChild(a),a.submit()}function openGraph(e){var t=mxUtils.parseXml($("#openedGraphxml").val()).documentElement;new mxCodec(t.ownerDocument).decode(t,e.getModel())}function addToolbarButton(t,e,n,a,o,r){var l=document.createElement("button");if(l.setAttribute("class","toolbarButton"),l.style.fontSize="10",null!=o){var i=document.createElement("img");i.setAttribute("src",o),i.style.width="16px",i.style.height="16px",i.style.verticalAlign="middle",i.style.marginRight="2px",l.appendChild(i)}r&&(l.style.background="transparent",l.style.color="#FFFFFF",l.style.border="none"),mxEvent.addListener(l,"click",function(e){t.execute(n)}),mxUtils.write(l,a),e.appendChild(l)}function clearToolbar(){var e=$("#searchToolbar").find(".mxToolbarMode");Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})}myEvent(chkevent,function(e){var t="Changes that you made may not be saved.";return(e||window.event).returnValue=t}),window.performance&&1==performance.navigation.type&&(window.location.href="/profile/");