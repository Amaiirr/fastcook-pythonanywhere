function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var r=jQuery.trim(n[a]);if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}function setCookie(e,t,n){var a="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),a="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"}var csrftoken=getCookie("csrftoken");function hideOnClk(e){var t=document.getElementById("byCategory"),n=document.getElementById("search");n.style.display="searchImage"==e?(document.getElementById("categoryImage").style.display="block",document.getElementById(e).style.display="none",t.style.display="none","block"):(document.getElementById("searchImage").style.display="block",document.getElementById(e).style.display="none",t.style.display="block","none")}var onStar=0;function mxIconSet(n){this.images=[];var e,a=n.view.graph;(e=mxUtils.createImage("/images/copy.png")).setAttribute("title","Duplicate"),e.style.position="absolute",e.style.cursor="pointer",e.style.width="16px",e.style.height="16px",e.style.left=n.x+n.width+"px",e.style.top=n.y+n.height+"px",mxEvent.addGestureListeners(e,mxUtils.bind(this,function(e){var t=a.gridSize;a.setSelectionCells(a.moveCells([n.cell],t,t,!0)),mxEvent.consume(e),this.destroy()})),n.view.graph.container.appendChild(e),this.images.push(e),(e=mxUtils.createImage("/images/delete2.png")).setAttribute("title","Delete"),e.style.position="absolute",e.style.cursor="pointer",e.style.width="16px",e.style.height="16px",e.style.left=n.x+n.width+"px",e.style.top=n.y-16+"px",mxEvent.addGestureListeners(e,mxUtils.bind(this,function(e){mxEvent.consume(e)})),mxEvent.addListener(e,"click",mxUtils.bind(this,function(e){a.removeCells([n.cell]),mxEvent.consume(e),this.destroy()})),n.view.graph.container.appendChild(e),this.images.push(e)}$(document).ready(function(){$("#stars li").on("mouseover",function(){var t=parseInt($(this).data("value"),10);$(this).parent().children("li.star").each(function(e){e<t?$(this).addClass("hover"):$(this).removeClass("hover")})}).on("mouseout",function(){$(this).parent().children("li.star").each(function(e){$(this).removeClass("hover")})}),$("#stars li").on("click",function(){onStar=parseInt($(this).data("value"),10);var e=$(this).parent().children("li.star");for(i=0;i<e.length;i++)$(e[i]).removeClass("selected");for(i=0;i<onStar;i++)$(e[i]).addClass("selected")})}),mxIconSet.prototype.destroy=function(){if(null!=this.images)for(var e=0;e<this.images.length;e++){var t=this.images[e];t.parentNode.removeChild(t)}this.images=null};var myEvent=window.attachEvent||window.addEventListener,chkevent=window.attachEvent?"onbeforeunload":"beforeunload";function main(){mxGraph.prototype.setAllowDanglingEdges(!1),mxConnectionHandler.prototype.connectImage=new mxImage("/images/connector.gif",16,16),mxGraphHandler.prototype.guidesEnabled=!0,mxGuide.prototype.isEnabledForEvent=function(e){return!mxEvent.isAltDown(e)};var e=new mxEditor,d=e.graph;d.getModel();d.dropEnabled=!0;var t,n,a,r;if(d.addMouseListener({currentState:null,currentIconSet:null,mouseDown:function(e,t){null!=this.currentState&&(this.dragLeave(t.getEvent(),this.currentState),this.currentState=null)},mouseMove:function(e,t){if(null!=this.currentState&&(t.getState()==this.currentState||null==t.getState())){var n=new mxRectangle(t.getGraphX()-20,t.getGraphY()-20,40,40);if(mxUtils.intersects(n,this.currentState))return}n=d.view.getState(t.getCell());(d.isMouseDown||null!=n&&!d.getModel().isVertex(n.cell))&&(n=null),n!=this.currentState&&(null!=this.currentState&&this.dragLeave(t.getEvent(),this.currentState),this.currentState=n,null!=this.currentState&&this.dragEnter(t.getEvent(),this.currentState))},mouseUp:function(e,t){},dragEnter:function(e,t){null==this.currentIconSet&&(this.currentIconSet=new mxIconSet(t))},dragLeave:function(e,t){null!=this.currentIconSet&&(this.currentIconSet.destroy(),this.currentIconSet=null)}}),$(".shareElements").on("input blur paste",function(){$(this).val($(this).val().replace(/\D/g,""))}),$("#share").on("click",function(e){var t=(new mxCodec).encode(d.getModel());sharedXMLData=mxUtils.getXml(t),$('input[name="currentGraphId"]').val($("#idOfGraph").val()),$('input[name="rating"]').val(onStar),$('input[name="sharedXMLData"]').val(sharedXMLData),0==onStar&&(e.preventDefault(),$(".error").css("display","block"))}),mxClient.isBrowserSupported()){var o=document.getElementById("searchToolbar"),c=new mxToolbar(o);c.enabled=!1;var l=document.getElementById("toptoolbar"),i=document.getElementById("content"),s=document.getElementById("generalContent"),m=document.getElementById("measurement"),u=document.getElementById("berries"),p=document.getElementById("dairies"),g=document.getElementById("desserts"),v=document.getElementById("dishes"),h=document.getElementById("fruits"),f=document.getElementById("meat"),x=document.getElementById("nut"),y=document.getElementById("vegetables"),b=document.getElementById("seafood"),w=document.getElementById("fastfood"),T=document.getElementById("other"),C=new mxToolbar(i);C.enabled=!1;var E=new mxToolbar(generalContent);E.enabled=!1;var k=new mxToolbar(m);k.enabled=!1;var I=new mxToolbar(u);I.enabled=!1;var S=new mxToolbar(p);S.enabled=!1;var G=new mxToolbar(g);G.enabled=!1;var B=new mxToolbar(h);B.enabled=!1;var D=new mxToolbar(f);D.enabled=!1;var M=new mxToolbar(x);M.enabled=!1;var A=new mxToolbar(y);A.enabled=!1;var L=new mxToolbar(b);L.enabled=!1;var O=new mxToolbar(w);O.enabled=!1;var U=new mxToolbar(T);U.enabled=!1;var X=new mxToolbar(v);X.enabled=!1;var N=new mxToolbar(s);N.enabled=!1;var V,R=document.getElementsByClassName("collapsible");for(V=0;V<R.length;V++)R[V].addEventListener("click",function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"});document.getElementsByClassName("diagramContainer")[0];var F=document.getElementById("container");mxClient.IS_QUIRKS&&(document.body.style.overflow="hidden",new mxDivResizer(tbContainer),new mxDivResizer(F));var j=new mxUndoManager,P=function(e,t){j.undoableEditHappened(t.getProperty("edit"))};d.getModel().addListener(mxEvent.UNDO,P),d.getView().addListener(mxEvent.UNDO,P),d.popupMenuHandler.factoryMethod=function(e,t,n){e.addItem("Undo",null,function(){j.undo()}),e.addItem("Redo",null,function(){j.redo()}),e.addSeparator(),e.addItem("Select ingredients",null,function(){d.selectVertices()}),e.addItem("Select all",null,function(){d.selectAll()})};var z=new mxKeyHandler(d);z.bindKey(46,function(e){d.isEnabled()&&d.removeCells()}),z.bindKey(8,function(e){d.isEnabled()&&d.removeCells()}),mxDragSource.prototype.getDropTarget=function(e,t,n){var a=e.getCellAt(t,n);return e.isValidDropTarget(a)||(a=null),a},d.setDropEnabled(!1),d.setAllowDanglingEdges(!1),e.setGraphContainer(F);var J=new mxCell("Group",new mxGeometry,"group");J.setVertex(!0),J.setConnectable(!1),e.defaultGroup=J,e.groupBorderSize=20,d.setConnectable(!0),loadStyleSheet(d,$("#openedGraphxml").val());var H=document.createElement("div");H.style.display="inline",H.style.paddingRight="117px",H.style.borderRight="2px solid #e0e0e0",H.style.borderLeft="2px solid #e0e0e0",H.setAttribute("class","verticalDivider"),l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"groupOrUngroup","(Un)group","/images/group.png"),e.addAction("groupOrUngroup",function(e,t){null!=(t=t||e.graph.getSelectionCell())&&e.graph.isSwimlane(t)?e.execute("ungroup",t):e.execute("group")}),addToolbarButton(e,l,"delete","Delete","/images/delete2.png"),H.style.paddingRight="40px",l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"cut","Cut","/images/cut.png"),addToolbarButton(e,l,"copy","Copy","/images/copy.png"),addToolbarButton(e,l,"paste","Paste","/images/paste.png"),l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"undo","","/images/undo.png"),addToolbarButton(e,l,"redo","","/images/redo.png"),l.appendChild(H.cloneNode(!0)),addToolbarButton(e,l,"zoomIn","","/images/zoomin.gif"),addToolbarButton(e,l,"zoomOut","","/images/zoomout.gif");var q=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,C,o,t)},K=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,k,o,t)},_=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,I,o,t)},Q=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,S,o,t)},Y=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,G,o,t)},W=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,X,o,t)},Z=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,B,o,t)},ee=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,D,o,t)},te=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,M,o,t)},ne=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,U,o,t)},ae=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,L,o,t)},re=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,A,o,t)};I.addLine(),k.addLine(),C.addLine();t="/images/text.png",n="text",a="Text",(r=new mxCell(null,new mxGeometry(0,0,100,40),n)).value=a,r.setVertex(!0),addToolbarItem(d,E,r,t),E.addLine()}else mxUtils.error("Browser is not supported!",200,!1);$(document).ready(function(){$("#loadAllTitles").on("click",".openGraph",function(e){$("#openModal").modal("hide");var r=$(this).attr("id"),t=getCookie("csrftoken");$.ajax({type:"GET",url:r,dataType:"text",headers:{"X-CSRFToken":t},success:function(e){var t=JSON.parse(e);xmlGraph=t[0].fields.XMLGraph,title=t[0].fields.title;var n=mxUtils.parseXml(xmlGraph).documentElement;new mxCodec(n.ownerDocument).decode(n,d.getModel()),$("#currentTitle").attr("value",title);var a=parseInt(r.match(/\d+/),10);$("#idOfGraph").val(a)}})})}),$(document).ready(function(){$("#saveNewTitle").on("click",function(e){var t=getCookie("csrftoken");title=$("#newTitle").val();var n=(new mxCodec).encode(d.getModel());xml=mxUtils.getXml(n),currentTitle=$("#currentTitle").val(),graphId=$("#idOfGraph").val(),$.ajax({type:"POST",url:"/saveNewTitle/",dataType:"text",data:{newTitle:title,currentTitle:currentTitle,xml:xml,graphId:graphId},headers:{"X-CSRFToken":t},success:function(e){parseData=JSON.parse(e),parseData.overwrite?alert(title+" already exists"):($("#currentTitle").val(title),$("#saveTitleModal").modal("hide"),$(".currentGraph").each(function(e,t){$(".openGraph").each(function(e,t){$(this).val()==currentTitle&&$(this).val(title)})}))}})})}),$("#loadAllTitles").on("click",".deleteGraph",function(e){var t=getCookie("csrftoken");e.preventDefault();var n=$(this).attr("id"),a=$(this).closest("tr");$.ajax({type:"DELETE",url:n,headers:{"X-CSRFToken":t},success:function(e){a.remove(),0==document.getElementById("graphList").rows.length&&($(window).off("beforeunload"),window.location.href="/profile/")}})}),$(document).ready(function(){$("#openXML").on("click",function(e){var t=getCookie("csrftoken");$.ajax({type:"GET",url:"/loadTitles/",dataType:"text",headers:{"X-CSRFToken":t},success:function(e){window.confirm=function(){return!1};var t=JSON.parse(e),n=Object.keys(t).length,a="/openGraph/"+t[n-1].pk,r=t[n-1].fields.title,o=(t[n-1].pk,'<input type="button" data-dismiss="modal" class = "openGraph btn btn-success" value="'+r+'" id='+a+"/>");0==$("#loadAllTitles").find("#"+$.escapeSelector(a+"/")).length&&$("#graphList").append("<tr> <td>"+o+"</td> </tr>")}})})}),$("#share").on("click",function(e){var t=(new mxCodec).encode(d.getModel());xml=mxUtils.getXml(t)}),$(document).ready(function(){$(".openFile").on("click",function(e){var t=getCookie("csrftoken"),n=(new mxCodec).encode(d.getModel()),a=mxUtils.getXml(n),r=(t=getCookie("csrftoken"),$("#openTitle").val());$.ajax({type:"POST",url:"/saveTitle/",data:{saveAsTitle:r,xml:a},dataType:"text",headers:{"X-CSRFToken":t},success:function(e){parseData=JSON.parse(e),parseData.overwrite?alert(r+" is already in use"):($("#idOfGraph").val(parseData.id),d.removeCells(d.getChildVertices(d.getDefaultParent())),d.selectChildCell(),d.removeCells(),$("#currentTitle").attr("value",r))}})})}),$(".dropdown-menu").on("click","#saveButton",function(e){var t=(new mxCodec).encode(d.getModel()),a=mxUtils.getXml(t),r=getCookie("csrftoken");$.ajax({type:"POST",url:"/overwrite/",data:{xml:a,title:$("#currentTitle").val(),graphId:$("#idOfGraph").val()},dataType:"text",headers:{"X-CSRFToken":r},success:function(e){var t=$("#currentTitle").val();JSON.parse(e).overwrite&&confirm(t+" already exists. Are you sure you want to overwrite changes to this file?")&&$.ajax({type:"POST",url:"/saveData/",data:{xml:a,title:$("#currentTitle").val()},headers:{"X-CSRFToken":r},success:function(e){var t=mxUtils.parseXml(a).documentElement;new mxCodec(t.ownerDocument).decode(t,d.getModel())}});var n=mxUtils.parseXml(a).documentElement;new mxCodec(n.ownerDocument).decode(n,d.getModel())}})}),$("#saveName").click(function(e){var t=getCookie("csrftoken"),n=(new mxCodec).encode(d.getModel());xml=mxUtils.getXml(n);t=getCookie("csrftoken");var a=$("#saveAsTitle").val();$.ajax({type:"POST",url:"/saveTitle/",data:{saveAsTitle:a,xml:xml},dataType:"text",headers:{"X-CSRFToken":t},success:function(e){var t=JSON.parse(e);t.overwrite?alert(a+" already exists"):($("#currentTitle").attr("value",a),$("#idOfGraph").val(t.id))}})}),$.ajax({url:"/loadIcons/",success:function(e){K("1 tbsp","/images/ingredients/Measurement/tablespoon.png",60,80,"measurement0"),K("1 tsp","/images/ingredients/Measurement/teaspoon.png",60,80,"measurement1"),K("1 scoop","/images/ingredients/Measurement/scoop.png",60,80,"measurement2"),K("1 cup","/images/ingredients/Measurement/cup.png",60,80,"measurement3"),K("1 inch","/images/ingredients/Measurement/ruler.png",60,80,"measurement4"),$("#searchEngine").autocomplete({source:e.allFiles});for(var t,n,a,r,o=3;0<=o;o--)t="60 Minutes",n="/images/ingredients/Equipment/"+e.equipment[o],a="equipment"+o,r=void 0,(r=new mxCell(t,new mxGeometry(0,0,60,80),a)).setVertex(!0),addToolbarItem(d,N,r,n);for(o=4;0<=o;o--)q("300g","/images/ingredients/Bakery/"+e.bakery[o],60,80,"rounded"+o);for(o=3;0<=o;o--)_("300g","/images/ingredients/Berries/"+e.berries[o],60,80,"berries"+o);for(o=2;0<=o;o--)Q("300g","/images/ingredients/Dairies/"+e.dairies[o],60,80,"dairies"+o);for(o=19;0<=o;o--)Z("300g","/images/ingredients/Fruits/"+e.fruits[o],60,80,"fruits"+o);for(o=8;0<=o;o--)ee("300g","/images/ingredients/Meat/"+e.meat[o],60,80,"meat"+o);for(o=3;0<=o;o--)te("300g","/images/ingredients/Nut/"+e.nut[o],60,80,"nut"+o);for(o=13;0<=o;o--)ne("300g","/images/ingredients/other/"+e.other[o],60,80,"other"+o);for(o=4;0<=o;o--)ae("300g","/images/ingredients/Seafood/"+e.seafood[o],60,80,"seafood"+o);for(o=26;0<=o;o--)re("300g","/images/ingredients/Vegetables/"+e.vegetables[o],60,80,"vegetables"+o);for(o=18;0<=o;o--)W("300g","/images/ingredients/Dishes/"+e.dishes[o],60,80,"dishes"+o);for(o=17;0<=o;o--)Y("300g","/images/ingredients/Desserts/"+e.desserts[o],60,80,"desserts"+o)}}),$.ajax({type:"GET",url:"/home/",dataType:"text",success:function(e){for(var t=JSON.parse(e).title,n=JSON.parse(t),a=n.length-1;0<=a;a--){var r=n[a].title,o="/openGraph/"+n[a].id,l=(n[a].id,'<input type="button" data-dismiss="modal" class = "openGraph btn btn-success" value="'+r+'" id='+o+"/>");$("#currentTitle").val()||$("#currentTitle").attr("value",$("#openedGraphTitle").val()),$("#graphList").append("<tr> <td>"+l+"</td> </tr>")}}}),$(document).ready(function(){$("#searchSubmit").on("click",function(e){e.preventDefault(),$.ajax({type:"POST",url:/search/,dataType:"text",headers:{"X-CSRFToken":csrftoken},data:{searchEngine:$("#searchEngine").val()},success:function(e){document.getElementById("noResults").innerHTML="";var t=JSON.parse(e),n=function(e,t,n,a,r){var o=new mxCell(e,new mxGeometry(0,0,n,a),r);o.setVertex(!0),addToolbarItem(d,c,o,t)};if(t[0].results){var a=t[0].length,r=t[0].file_direc;document.getElementById("noResults").innerHTML="";var o=r.replace("home/fastcookapp/fastcook-pythonanywhere/fastcookapp/",""),l=o.split("/")[3],i=o.split("/")[4];i=i.replace(".png","");var s=l.toLowerCase();"equipment"==s?(clearToolbar(),n("60 minutes",o,60,80,s+a)):"tablespoon"==i?(clearToolbar(),n("1 tbsp","/images/ingredients/measurement/tablespoon.png",60,80,"measurement0")):"teaspoon"==i?(clearToolbar(),n("1 tsp","/images/ingredients/measurement/teaspoon.png",60,80,"measurement1")):"cup"==i?(clearToolbar(),n("1 cup","/images/ingredients/measurement/scoop.png",60,80,"measurement2")):"cup"==i?(clearToolbar(),n("1 cup","/images/ingredients/measurement/cup.png",60,80,"measurement3")):"ruler"==i?(clearToolbar(),n("1 inch","/images/ingredients/measurement/ruler.png",60,80,"measurement4")):(clearToolbar(),n("300g",o,60,80,s+a))}else clearToolbar(),$("#noResults").append("</br> There are no results to be found ")}})})}),$(document).ready(function(){$("#categoryImage").on("click",function(e){clearToolbar()})})}function addToolbarItem(e,t,o,n){var a=function(e,t,n){e.stopEditing(!1);var a=e.getPointForEvent(t),r=e.getModel().cloneCell(o);r.geometry.x=a.x,r.geometry.y=a.y,e.setSelectionCells(e.importCells([r],0,0,n))},r=t.addMode(null,n,a);mxUtils.makeDraggable(r,e,a)}function post(e,t,n){n=n||"post";var a=document.createElement("form");a.setAttribute("method",n),a.setAttribute("action",e),a.setAttribute("target","_blank");var r=document.createElement("input");r.type="hidden",r.name="csrfmiddlewaretoken",r.value=getCookie("csrftoken"),a.appendChild(r);var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","currentGraphId"),o.setAttribute("value",$("#idOfGraph").val()),a.appendChild(o);var l=document.createElement("input");for(var i in l.setAttribute("type","hidden"),l.setAttribute("name","rating"),l.setAttribute("value",onStar),a.appendChild(l),t)if(t.hasOwnProperty(i)){var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name",i),s.setAttribute("value",t[i]),a.appendChild(s)}document.body.appendChild(a),a.submit()}function openGraph(e){var t=mxUtils.parseXml($("#openedGraphxml").val()).documentElement;new mxCodec(t.ownerDocument).decode(t,e.getModel())}function addToolbarButton(t,e,n,a,r,o){var l=document.createElement("button");if(l.setAttribute("class","toolbarButton"),l.style.fontSize="10",null!=r){var i=document.createElement("img");i.setAttribute("src",r),i.style.width="16px",i.style.height="16px",i.style.verticalAlign="middle",i.style.marginRight="2px",l.appendChild(i)}o&&(l.style.background="transparent",l.style.color="#FFFFFF",l.style.border="none"),mxEvent.addListener(l,"click",function(e){t.execute(n)}),mxUtils.write(l,a),e.appendChild(l)}function clearToolbar(){var e=$("#searchToolbar").find(".mxToolbarMode");Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})}myEvent(chkevent,function(e){var t="Changes that you made may not be saved.";return(e||window.event).returnValue=t}),window.performance&&1==performance.navigation.type&&(window.location.href="/profile/");